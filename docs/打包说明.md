# Yeah 商务管理系统 - 打包为 EXE 说明

## 📋 准备工作

### 1. 确保已安装所有依赖
确保你的虚拟环境已经激活，并且安装了所有必需的包：

```bash
# 激活虚拟环境
.venv\Scripts\activate

# 查看已安装的包
pip list
```

### 2. 检查 logo 文件
确保 `assets/logo.png` 文件存在。

---

## 🚀 快速打包（推荐）

### 方法一：使用自动化脚本（最简单）

直接双击运行 `build_exe.bat` 文件，脚本会自动完成以下操作：
1. 检查虚拟环境
2. 安装打包依赖（pyinstaller, pillow）
3. 转换图标格式（PNG → ICO）
4. 执行打包

**打包完成后，可执行文件位于：`dist/Yeah商务管理系统.exe`**

---

## 🛠 手动打包（分步执行）

如果自动化脚本遇到问题，可以按以下步骤手动执行：

### 步骤 1：安装打包工具

```bash
# 激活虚拟环境
.venv\Scripts\activate

# 安装 PyInstaller 和 Pillow
pip install pyinstaller pillow
```

### 步骤 2：转换图标格式

```bash
# 运行图标转换脚本
python convert_icon.py
```

这会在 `assets` 文件夹下生成 `logo.ico` 文件。

### 步骤 3：执行打包

```bash
# 使用 spec 配置文件打包
pyinstaller yeah_erp.spec --clean
```

### 步骤 4：测试可执行文件

打包完成后，在 `dist` 文件夹中会生成 `Yeah商务管理系统.exe`。

双击运行测试：
- ✅ 窗口左上角应显示 logo 图标
- ✅ 任务栏应显示 logo 图标
- ✅ 所有功能正常运行

---

## 📦 打包说明

### 生成的文件结构

```
dist/
└── Yeah商务管理系统.exe    # 单文件可执行程序（约 50-80MB）
```

### 打包配置说明（yeah_erp.spec）

- **单文件打包**：所有依赖打包到一个 EXE 文件中
- **无控制台**：运行时不显示黑色命令行窗口
- **包含资源**：自动包含 `assets` 文件夹
- **图标设置**：使用 `assets/logo.ico` 作为程序图标

---

## ⚠️ 常见问题

### 1. 打包后运行报错 "找不到模块"

**解决方案**：在 `yeah_erp.spec` 的 `hiddenimports` 中添加缺失的模块。

例如：
```python
hiddenimports=[
    'PIL._tkinter_finder',
    'customtkinter',
    '你缺失的模块名',
],
```

### 2. 图标没有显示

**可能原因**：
- `assets/logo.ico` 文件未生成或损坏
- 需要先运行 `convert_icon.py` 转换图标

**解决方案**：
```bash
python convert_icon.py
```

### 3. 打包后文件太大

**优化方案**：

a) 使用 UPX 压缩（已在 spec 中启用）

b) 排除不必要的库：
```python
excludes=[
    'matplotlib',
    'numpy',
    'pandas',
    # 其他不需要的库
],
```

### 4. 打包速度慢

**原因**：PyInstaller 需要分析所有依赖关系。

**建议**：
- 首次打包较慢（5-10 分钟），后续打包会快一些
- 使用 `--clean` 参数确保清理旧的缓存

---

## 🎯 高级选项

### 自定义打包配置

编辑 `yeah_erp.spec` 文件，可以修改：

1. **程序名称**：
```python
name='你的程序名',
```

2. **添加其他资源文件**：
```python
datas=[
    ('assets', 'assets'),
    ('config', 'config'),  # 添加其他文件夹
],
```

3. **设置版本信息**（需要额外的 version 文件）

### 打包为文件夹模式（调试用）

如果单文件模式有问题，可以尝试文件夹模式：

```bash
pyinstaller main.py --name="Yeah商务管理系统" --icon=assets/logo.ico --noconsole --onedir
```

这会在 `dist` 下生成一个文件夹，包含 EXE 和所有依赖。

---

## 📝 打包后的分发

### 分发给其他用户

打包完成后，只需要分发 `dist/Yeah商务管理系统.exe` 文件即可。

**注意事项**：
- ✅ 用户无需安装 Python
- ✅ 用户无需安装任何依赖库
- ✅ 首次运行会在用户的 `C:\Users\用户名\Yeah2Data\` 创建数据库
- ⚠️ 部分杀毒软件可能误报，需要添加信任

### Windows Defender 误报处理

如果 Windows Defender 误报病毒：

1. 打开 Windows 安全中心
2. 病毒和威胁防护 → 管理设置
3. 添加排除项 → 文件 → 选择 `Yeah商务管理系统.exe`

---

## 🔧 重新打包

如果修改了代码，需要重新打包：

```bash
# 清理旧的打包文件
pyinstaller yeah_erp.spec --clean

# 或使用脚本
build_exe.bat
```

---

## 📞 技术支持

如果遇到打包问题：

1. 检查 Python 版本（建议 3.10+）
2. 检查所有依赖是否已安装
3. 查看打包日志中的错误信息
4. 尝试在虚拟环境中重新安装依赖

---

## ✅ 打包检查清单

打包前请确认：

- [ ] 所有功能在开发环境中正常运行
- [ ] `assets/logo.png` 文件存在
- [ ] 虚拟环境已激活
- [ ] 已安装 pyinstaller 和 pillow
- [ ] 代码中没有硬编码的绝对路径

打包后请测试：

- [ ] EXE 文件可以正常启动
- [ ] 图标正确显示
- [ ] 所有页面功能正常
- [ ] 数据库可以正常创建和读写
- [ ] 搜索、增删改查功能正常

---

**祝打包顺利！🎉**

